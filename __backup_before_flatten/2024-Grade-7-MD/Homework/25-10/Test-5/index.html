<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Submission</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>
<body class="bg-slate-100">
    <div id="modal" class="modal hidden fixed inset-0 bg-slate-800 bg-opacity-75 flex items-center justify-center z-50 p-4 opacity-0">
        <div class="modal-content w-full max-w-4xl bg-white p-6 rounded-xl shadow-lg text-center transform scale-95">
            <h2 id="modal-title" class="text-2xl font-bold text-slate-800 mb-4"></h2>
            <div id="modal-body" class="text-slate-600 mb-6 text-left max-h-[70vh] overflow-y-auto"></div>
            <div id="modal-footer" class="flex gap-3 justify-end"></div>
        </div>
    </div>
    <div id="login-overlay" class="hidden fixed inset-0 bg-slate-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="w-full max-w-sm bg-white p-8 rounded-xl shadow-lg text-center">
            <h2 class="text-2xl font-bold text-slate-800 mb-2">Teacher Access</h2>
            <p class="text-slate-500 mb-6">Enter password to view all submissions.</p>
            <form id="login-form">
                <input type="password" id="password-input" class="bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 mb-4 text-center" placeholder="••••••••" required>
                <div class="flex gap-2">
                    <button type="button" id="cancel-login-button" class="w-full text-slate-700 bg-slate-200 hover:bg-slate-300 font-medium rounded-lg text-base px-5 py-2.5">Cancel</button>
                    <button type="submit" class="w-full text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-base px-5 py-2.5">Unlock</button>
                </div>
            </form>
            <p id="login-error" class="text-red-500 text-sm mt-4 hidden">Incorrect password.</p>
        </div>
    </div>
    <div id="chat-modal" class="hidden fixed bottom-4 right-4 md:right-8 w-[calc(100%-2rem)] md:w-96 h-[60vh] bg-white rounded-xl shadow-2xl flex flex-col z-40">
        <div id="chat-header" class="flex items-center justify-between p-3 bg-blue-600 text-white rounded-t-xl">
            <h3 id="chat-title" class="font-bold">Message</h3>
            <button id="close-chat-button" class="p-1 hover:bg-blue-700 rounded-full">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <div id="chat-body" class="flex-1 flex overflow-hidden">
            <div id="teacher-chat-view" class="hidden w-full h-full md:flex">
                <div id="student-list-pane" class="w-1/3 border-r bg-slate-50 overflow-y-auto"></div>
                <div id="teacher-message-pane" class="w-2/3 flex flex-col"></div>
            </div>
            <div id="student-chat-view" class="w-full flex flex-col h-full"></div>
        </div>
    </div>
    <button id="open-chat-button" class="hidden fixed bottom-4 right-4 bg-blue-600 text-white p-3 rounded-full shadow-lg z-30">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 5.523-4.477 10-10 10S1 17.523 1 12 5.477 2 11 2s10 4.477 10 10z"></path></svg>
    </button>
    <main id="main-content" class="w-full max-w-5xl mx-auto p-2 sm:p-6 lg:p-8">

        <div id="student-selection-view">
            <div class="bg-white p-8 rounded-xl shadow-lg text-center">
                <h1 id="quiz-title" class="text-3xl font-bold text-slate-800">Assignment</h1>
                <p class="text-slate-500 mt-2 mb-6">Please select your name to begin.</p>
                <div class="max-w-xs mx-auto">
                    <select id="student-select" class="bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                        <option value="">-- Select Your Name --</option>
                        <optgroup label="Grade 7">
                            <option value="Ngô Cao Minh">Ngô Cao Minh</option>
                            <option value="Nguyễn Gia Phúc">Nguyễn Gia Phúc</option>
                            <option value="Nguyễn Huy Hải Nam">Nguyễn Huy Hải Nam</option>
                            <option value="Tống Gia Bảo">Tống Gia Bảo</option>
                            <option value="Hứa Diệu Linh">Hứa Diệu Linh</option>
                            <option value="Ngô Chúc An">Ngô Chúc An</option>
                            <option value="Đỗ Bảo Khánh">Đỗ Bảo Khánh</option>
                            <option value="Nguyễn Hoàng Diệu">Nguyễn Hoàng Diệu</option>
                            <option value="Nguyễn Cẩm Tú">Nguyễn Cẩm Tú</option>
                            <option value="Ngọc Anh">Ngọc Anh</option>
                        </optgroup>
                    </select>
                    <button id="start-assignment-button" class="mt-4 w-full text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-base px-5 py-2.5">Start Assignment</button>
                    <p id="student-select-error" class="text-red-500 text-sm mt-2 hidden">Please select your name.</p>
                </div>
                <div class="mt-8 text-center border-t pt-4">
                    <button id="teacher-login-button" class="text-slate-600 hover:text-blue-600 text-sm font-medium">Teacher Login</button>
                </div>
            </div>
        </div>
        <div id="form-view" class="hidden">
            <div class="bg-white p-4 sm:p-8 rounded-xl shadow-lg">
                <div class="text-center border-b pb-4 mb-6">
                    <h1 id="quiz-title-main" class="text-2xl font-bold text-slate-800">Assignment</h1>
                    <p class="text-slate-500 mt-1">Submitting as: <span id="student-display-name" class="font-bold"></span></p>
                </div>
                <form id="submission-form" novalidate>
                    <div id="tab-container" class="mb-6 border-b border-slate-200">
                        <nav class="-mb-px flex flex-wrap gap-2" aria-label="Tabs"></nav>
                    </div>
                    <div id="quiz-container"></div>
                    <div class="mt-8 pt-6 border-t text-center">
                        <button type="submit" id="submit-button" class="text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-base w-full sm:w-auto px-8 py-3">Submit Final Answers</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="submitted-view" class="hidden">
            <div class="bg-white p-8 rounded-xl shadow-lg text-center">
                <h1 class="text-3xl font-bold text-slate-800">Submission Confirmed</h1>
                <p id="submission-text" class="text-slate-500 mt-2 mb-6">You have already completed this assignment.</p>
                <div class="flex flex-col items-center gap-3 max-w-xs mx-auto">
                    <button id="view-results-button" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-base px-5 py-2.5">View Your Results</button>
                    <button id="request-resubmission-button" class="w-full text-white bg-orange-500 hover:bg-orange-600 font-medium rounded-lg text-base px-5 py-2.5 hidden">Request Resubmission</button>
                    <button id="back-to-select-button" class="w-full text-slate-700 bg-slate-200 hover:bg-slate-300 font-medium rounded-lg text-base px-5 py-2.5">Exit</button>
                </div>
                <section id="results-section" class="hidden mt-6"></section>
            </div>
        </div>
        <div id="all-submissions-view" class="hidden">
            <div class="bg-white p-4 sm:p-8 rounded-xl shadow-lg">
                <div class="flex justify-between items-center mb-6 border-b pb-4">
                    <h2 class="text-3xl font-bold text-slate-800">All Submissions</h2>
                    <div class="flex items-center gap-4">
                        <button id="teacher-messages-button" class="text-white bg-purple-600 hover:bg-purple-700 font-medium rounded-lg text-sm px-5 py-2.5">Messages</button>
                        <button id="teacher-logout-button" class="text-slate-700 bg-slate-200 hover:bg-slate-300 font-medium rounded-lg text-sm px-5 py-2.5">Logout</button>
                    </div>
                </div>
                <div class="border rounded-lg overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-slate-50">
                            <tr>
                                <th class="p-3 font-semibold">Student Name</th>
                                <th class="p-3 font-semibold">Score</th>
                                <th class="p-3 font-semibold">Submitted At</th>
                                <th class="p-3 font-semibold">Status</th>
                                <th class="p-3 font-semibold">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="submissions-table-body">
                            <tr id="loading-row">
                                <td colspan="5" class="text-center p-4 text-slate-500">Loading submissions...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="teacher-submission-modal" class="hidden fixed inset-0 bg-slate-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
                    <div class="w-full max-w-4xl bg-white p-6 rounded-xl shadow-lg transform">
                        <div id="teacher-submission-modal-body" class="max-h-[80vh] overflow-y-auto"></div>
                        <div class="mt-4 text-right">
                            <button onclick="document.getElementById('teacher-submission-modal').classList.add('hidden')" class="text-slate-700 bg-slate-200 hover:bg-slate-300 font-medium rounded-lg text-sm px-5 py-2.5">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script type="module" src="/js/main.js"></script>
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col items-end gap-3"></div>
</body>
</html>